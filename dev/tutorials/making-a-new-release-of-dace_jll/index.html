<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Making a new release of DACE_jll · DACE.jl</title><meta name="title" content="Making a new release of DACE_jll · DACE.jl"/><meta property="og:title" content="Making a new release of DACE_jll · DACE.jl"/><meta property="twitter:title" content="Making a new release of DACE_jll · DACE.jl"/><meta name="description" content="Documentation for DACE.jl."/><meta property="og:description" content="Documentation for DACE.jl."/><meta property="twitter:description" content="Documentation for DACE.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DACE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../setting-up-your-development-environment/">Setting up your development environment</a></li><li><a class="tocitem" href="../modifying-the-cxx-side-of-the-interface/">Modifying the C++ side of the interface</a></li><li class="is-active"><a class="tocitem" href>Making a new release of DACE_jll</a><ul class="internal"><li><a class="tocitem" href="#Make-changes-to-the-DACE-C-code"><span>Make changes to the DACE C++ code</span></a></li><li><a class="tocitem" href="#Fork-the-Yggdrasil-repository"><span>Fork the Yggdrasil repository</span></a></li><li><a class="tocitem" href="#Update-the-version-and-commit-hash"><span>Update the version and commit hash</span></a></li><li><a class="tocitem" href="#Check-the-version-of-libcxxwrap_julia_jll"><span>Check the version of libcxxwrap_julia_jll</span></a></li><li><a class="tocitem" href="#Create-a-pull-request"><span>Create a pull request</span></a></li><li><a class="tocitem" href="#Reference"><span>Reference</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/sine/">Sine function</a></li><li><a class="tocitem" href="../../generated/polynomial_inversion/">Polynomial inversion</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Making a new release of DACE_jll</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Making a new release of DACE_jll</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/a-ev/DACE.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/a-ev/DACE.jl/blob/main/docs/src/tutorials/making-a-new-release-of-dace_jll.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Making-a-new-release-of-DACE_jll"><a class="docs-heading-anchor" href="#Making-a-new-release-of-DACE_jll">Making a new release of DACE_jll</a><a id="Making-a-new-release-of-DACE_jll-1"></a><a class="docs-heading-anchor-permalink" href="#Making-a-new-release-of-DACE_jll" title="Permalink"></a></h1><p>The <em>DACE_jll</em> Julia package contains the prebuilt DACE library (prebuilt for all combinations of platforms, Julia versions, etc. that Julia is supported on). <a href="https://docs.binarybuilder.org/stable/">BinaryBuilder.jl</a> is used to build the libraries and publish them to the Julia registry.</p><p>The recipe for building the DACE library can be found on <a href="https://github.com/JuliaPackaging/Yggdrasil">Yggdrasil</a> in the <em>D/DACE</em> directory.</p><p>To make a new release of the DACE_jll package you can follow the steps in the following sections.</p><h2 id="Make-changes-to-the-DACE-C-code"><a class="docs-heading-anchor" href="#Make-changes-to-the-DACE-C-code">Make changes to the DACE C++ code</a><a id="Make-changes-to-the-DACE-C-code-1"></a><a class="docs-heading-anchor-permalink" href="#Make-changes-to-the-DACE-C-code" title="Permalink"></a></h2><p>Make your changes and commit them in the <a href="https://github.com/a-ev/dace/tree/julia-interface">dace</a> repo and test them (see <a href="../setting-up-your-development-environment/">setting up your development environment</a> for help getting started with this step).</p><p>Make a note of the unique commit hash that identifies the commit that you want the new release of DACE_jll to be built against. This hash can be found using <code>git log</code> or via the commits view in the GitHub interface.</p><p><img src="../../assets/commithash.png" alt="commithash.png"/></p><h2 id="Fork-the-Yggdrasil-repository"><a class="docs-heading-anchor" href="#Fork-the-Yggdrasil-repository">Fork the Yggdrasil repository</a><a id="Fork-the-Yggdrasil-repository-1"></a><a class="docs-heading-anchor-permalink" href="#Fork-the-Yggdrasil-repository" title="Permalink"></a></h2><p>On GitHub, make a fork of the <a href="https://github.com/JuliaPackaging/Yggdrasil">Yggdrasil</a> repository, clone that locally and create a branch for your changes</p><pre><code class="language-bash hljs"># fork in the github web interface, then...

# clone the repo (replace with the correct URL for your fork)
git clone git@github.com:&lt;namespace&gt;/Yggdrasil.git

# change directory into the repo
cd Yggdrasil

# switch to a new branch
git checkout -b update-dace

# switch to the D/DACE directory
cd D/DACE</code></pre><h2 id="Update-the-version-and-commit-hash"><a class="docs-heading-anchor" href="#Update-the-version-and-commit-hash">Update the version and commit hash</a><a id="Update-the-version-and-commit-hash-1"></a><a class="docs-heading-anchor-permalink" href="#Update-the-version-and-commit-hash" title="Permalink"></a></h2><p>Edit the <em>build_tarballs.jl</em> file:</p><ul><li><p>bump the version of the release on or around line 11:</p><pre><code class="nohighlight hljs">version = v&quot;0.1.0&quot;</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>It is highly recommended to follow <a href="https://semver.org/">semantic versioning</a></p></div></div></li><li><p>change the commit hash (on or around line 15) that the new version will be based on to the hash of the commit you identified <a href="#Make-changes-to-the-DACE-C-code">above</a></p><pre><code class="nohighlight hljs">GitSource(&quot;https://github.com/a-ev/dace.git&quot;, &quot;9fe534f9b27c147a171bce1ad7dc8b4706a9457e&quot;),</code></pre><p>where <em>9fe534f9b27c147a171bce1ad7dc8b4706a9457e</em> is the commit hash</p></li></ul><h2 id="Check-the-version-of-libcxxwrap_julia_jll"><a class="docs-heading-anchor" href="#Check-the-version-of-libcxxwrap_julia_jll">Check the version of libcxxwrap_julia_jll</a><a id="Check-the-version-of-libcxxwrap_julia_jll-1"></a><a class="docs-heading-anchor-permalink" href="#Check-the-version-of-libcxxwrap_julia_jll" title="Permalink"></a></h2><p>In <em>build_tarballs.jl</em>, check the version of <em>libcxxwrap_julia_jll</em> which is linked to the version of <em>CxxWrap.jl</em>. When bumping the version of the CxxWrap dependency in the <em>DACE.jl</em> package you may also need to bump the version of <em>libcxxwrap_julia_jll</em> on or around line 55:</p><pre><code class="nohighlight hljs">Dependency(&quot;libcxxwrap_julia_jll&quot;; compat = &quot;~0.12.2&quot;),</code></pre><div class="admonition is-category-important"><header class="admonition-header">Important</header><div class="admonition-body"><p>Make sure the version of <em>libcxxwrap_julia_jll</em> is compatible with the version of <em>CxxWrap,jl</em> in your <em>Project.toml</em> for <em>DACE.jl</em>. See also the <a href="https://github.com/JuliaInterop/libcxxwrap-julia?tab=readme-ov-file#using-libcxxwrap-julia-as-a-dependency-for-downstream-packages">Using libcxxwrap-julia as a dependency for downstream packages</a>.</p></div></div><h2 id="Create-a-pull-request"><a class="docs-heading-anchor" href="#Create-a-pull-request">Create a pull request</a><a id="Create-a-pull-request-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-pull-request" title="Permalink"></a></h2><p>Commit and push your changes into your fork of Yggdrasil:</p><pre><code class="nohighlight hljs">git add build_tarballs.jl
git commit -m &quot;[DACE] bump version&quot;
git push</code></pre><p>You may need to set the upstream of your repo for <code>git push</code> to work. The above commands are just examples and may need tweaking.</p><p>Create a pull request back to the main Yggdrasil repo. The builds will run automatically and you can view their status in the pull request. If they all succeed someone will merge them automatically (you don&#39;t need to do anything else). For example, see the <a href="https://github.com/JuliaPackaging/Yggdrasil/pull/8493">Add DACE recipe pull request</a>.</p><h2 id="Reference"><a class="docs-heading-anchor" href="#Reference">Reference</a><a id="Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Reference" title="Permalink"></a></h2><details><summary>View complete example of build_tarballs.jl</summary><pre><code class="language-julia hljs"># Note that this script can accept some limited command-line arguments, run
# `julia build_tarballs.jl --help` to see a usage message.
using BinaryBuilder, Pkg

# See https://github.com/JuliaLang/Pkg.jl/issues/2942
# Once this Pkg issue is resolved, this must be removed
uuid = Base.UUID(&quot;a83860b7-747b-57cf-bf1f-3e79990d037f&quot;)
delete!(Pkg.Types.get_last_stdlibs(v&quot;1.6.3&quot;), uuid)

name = &quot;DACE&quot;
version = v&quot;0.1.0&quot;

# Collection of sources required to build DACE
sources = [
    GitSource(&quot;https://github.com/a-ev/dace.git&quot;, &quot;9fe534f9b27c147a171bce1ad7dc8b4706a9457e&quot;),
    DirectorySource(&quot;./bundled&quot;),
]

# Bash recipe for building across all platforms
script = raw&quot;&quot;&quot;
cd $WORKSPACE/srcdir/dace

git apply ../patches/no-safe-strings.patch

cmake . -B build \
    -DJulia_PREFIX=${prefix} \
    -DCMAKE_INSTALL_PREFIX=${prefix} \
    -DCMAKE_TOOLCHAIN_FILE=${CMAKE_TARGET_TOOLCHAIN} \
    -DCMAKE_FIND_ROOT_PATH=${prefix} \
    -DCMAKE_BUILD_TYPE=Release \
    -DWITH_PTHREAD=ON \
    -DWITH_ALGEBRAICMATRIX=ON \
    -DCMAKE_CXX_STANDARD=17 \
    -DWITH_JULIA=ON

VERBOSE=ON cmake --build build --config Release --target install -- -j${nproc}

install_license {LICENSE,NOTICE}
&quot;&quot;&quot;

# These are the platforms we will build for by default, unless further
# platforms are passed in on the command line
include(&quot;../../L/libjulia/common.jl&quot;)
platforms = vcat(libjulia_platforms.(julia_versions)...)
platforms = expand_cxxstring_abis(platforms)

# The products that we will ensure are always built
products = [
    LibraryProduct(&quot;libdace&quot;, :libdace),
]

# Dependencies that must be installed before this package can be built
dependencies = [
    BuildDependency(PackageSpec(name=&quot;libjulia_jll&quot;)),
    Dependency(&quot;libcxxwrap_julia_jll&quot;; compat = &quot;~0.12.2&quot;),
]

# Build the tarballs, and possibly a `build.jl` as well.
build_tarballs(
    ARGS,
    name,
    version,
    sources,
    script,
    platforms,
    products,
    dependencies;
    julia_compat = &quot;1.6&quot;,
    preferred_gcc_version = v&quot;12&quot;,
)

# rebuild trigger: 0</code></pre></details></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../modifying-the-cxx-side-of-the-interface/">« Modifying the C++ side of the interface</a><a class="docs-footer-nextpage" href="../../generated/sine/">Sine function »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Thursday 18 April 2024 05:10">Thursday 18 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
